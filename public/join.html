<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>join169</title>
    <style>
        @font-face {
            font-family: 'LINESeedKR-Bd';
            src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_11-01@1.0/LINESeedKR-Bd.woff2') format('woff2');
            font-weight: 700; font-style: normal;
        }
        
    </style>
</head>
<body>
    <div class="Join169" style="width: 1920px; height: 1080px; position: relative; background: white">
        <div class="BgBox" style="width: 1926px; height: 1482.13px; left: -9px; top: -270px; position: absolute">
          <div class="BackDiv" style="width: 1912.72px; height: 1236.40px; left: 6.64px; top: 100.26px; position: absolute; background: #D9D9D9"></div>
          <img class="BgImg" style="width: 1926px; height: 1482.13px; left: 0px; top: 0px; position: absolute" src="./assets/img/bg_img.png" />
        </div>

        <div class="RightBox" style="width: 391.39px; height: 972.44px; left: 1496.06px; top: 54.18px; position: absolute">
          <div class="RightStick" style="width: 391.39px; height: 972.44px; left: 0px; top: 0px; position: absolute; background: #FF4444; box-shadow: 0px 9px 4px rgba(0, 0, 0, 0.25); border-radius: 100px"></div>
          <div class="RightR" style="width: 113.90px; height: 113.55px; left: 196.73px; top: 579.13px; position: absolute; background: black; box-shadow: 0px 9px 4px rgba(0, 0, 0, 0.25); border-radius: 141px"></div>
          <div class="RightR01" style="width: 44.52px; height: 44.39px; left: 230.90px; top: 238.46px; position: absolute; background: black; box-shadow: 0px 9px 4px rgba(0, 0, 0, 0.25); border-radius: 141px"></div>
          <div class="RightR02" style="width: 44.52px; height: 44.39px; left: 270.25px; top: 277.69px; position: absolute; background: black; box-shadow: 0px 9px 4px rgba(0, 0, 0, 0.25); border-radius: 141px"></div>
          <div class="RightR03" style="width: 44.52px; height: 44.39px; left: 192.59px; top: 277.69px; position: absolute; background: black; box-shadow: 0px 9px 4px rgba(0, 0, 0, 0.25); border-radius: 141px"></div>
          <div class="RightR04" style="width: 44.52px; height: 44.39px; left: 230.90px; top: 315.89px; position: absolute; background: black; box-shadow: 0px 9px 4px rgba(0, 0, 0, 0.25); border-radius: 141px"></div>
          <div class="RBox" style="width: 28.99px; height: 28.90px; left: 160.49px; top: 764.94px; position: absolute; background: black; box-shadow: 0px 4px 5px rgba(0, 0, 0, 0.25)"></div>
          <button class="MypageIcon" style="width: 54.59px; height: 65.32px; left: 225.29px; top: 602.31px; position: absolute; background:black; border: 3.33px black solid">
            <image src="./assets/img/mypage_icon.png" alt="Button Image"></image>
          </button>
        </div>

        <div class="LeftBox" style="width: 391.39px; height: 972.44px; left: 33px; top: 54.18px; position: absolute">
          <div class="LeftStick" style="width: 391.39px; height: 972.44px; left: 0px; top: 0px; position: absolute; background: #2BD9FF; box-shadow: 0px 9px 4px rgba(0, 0, 0, 0.25); border-radius: 100px"></div>
          <div class="LeftR" style="width: 113.90px; height: 113.55px; left: 77.66px; top: 265.30px; position: absolute; background: black; box-shadow: 0px 9px 4px rgba(0, 0, 0, 0.25); border-radius: 141px"></div>
          <div class="LeftR01" style="width: 44.52px; height: 44.39px; left: 111.83px; top: 570.87px; position: absolute; background: black; box-shadow: 0px 9px 4px rgba(0, 0, 0, 0.25); border-radius: 141px"></div>
          <div class="LeftR02" style="width: 44.52px; height: 44.39px; left: 151.17px; top: 610.09px; position: absolute; background: black; box-shadow: 0px 9px 4px rgba(0, 0, 0, 0.25); border-radius: 141px"></div>
          <div class="LeftR03" style="width: 44.52px; height: 44.39px; left: 73.52px; top: 610.09px; position: absolute; background: black; box-shadow: 0px 9px 4px rgba(0, 0, 0, 0.25); border-radius: 141px"></div>
          <div class="LeftR04" style="width: 44.52px; height: 44.39px; left: 111.83px; top: 648.29px; position: absolute; background: black; box-shadow: 0px 9px 4px rgba(0, 0, 0, 0.25); border-radius: 141px"></div>
          <div class="LBox" style="width: 28.99px; height: 28.90px; left: 185.34px; top: 764.94px; position: absolute; background: black"></div>
          <button class="ChatIcon" style="width: 54.59px; height: 48.99px; left: 109.28px; top: 299.43px; position: absolute; background: black;">
            <image src="./assets/img/chat_icon.png" alt="Button Image"></image>
          </button>
        </div>

        <div class="BottomBox" style="width: 1325.55px; height: 972.92px; left: 290.90px; top: 54px; position: absolute">
          <div class="BottomBox" style="width: 1325.55px; height: 972.92px; left: 0px; top: 0px; position: absolute; background: #2E2E2E; box-shadow: 0px 9px 4px rgba(0, 0, 0, 0.25)"></div>
          <div class="BottomScreen" style="width: 1280px; height: 928.76px; left: 24.04px; top: 22.06px; position: absolute; background: #FCFCFF"></div>
        </div>

        <img class="Logo" style="width: 400px; height: 400px; left: 760px; top: 313px; position: absolute" src="./assets/logo.gif" />
        
        <div class="Loading" style="width: 500px; height: 148px; left: 734px; top: 199px; position: absolute">
          <div id="message" class="ready_msg" style="display:none; left: 0px; top: 103px; position: absolute; text-align: center; color: black; font-size: 45px; font-family: 'LINESeedKR-Bd'; font-weight: 400; word-wrap: break-word">잠시 후 게임이 시작됩니다</div>
          <img class="Coins" style="display:none; width: 75px; height: 71.79px; left: 78px; top: 0px; position: absolute" src="./assets/coin.gif" />
          <img class="Coins" style="display:none; width: 75px; height: 71.79px; left: 193px; top: 0px; position: absolute" src="./assets/coin.gif" />
          <img class="Coins" style="display:none; width: 75px; height: 71.79px; left: 308px; top: 0px; position: absolute" src="./assets/coin.gif" />
        </div>

        <input type="text" id= "nickname"class="InputBox" placeholder="Nickname" style="width: 467px; height: 63px; left: 726px; top: 677px; position: absolute;
        color: black; font-size: 45px; font-family: 'LINESeedKR-Bd'; font-weight: 400; word-wrap: break-word;
        background: #FFECAA; border-radius: 10px;">

        <button type="button" type="button" id="create-btn" class="Create" style="width: 203.76px; height: 53px; left: 726px; top: 792px; position: absolute;
        background: #FBC847; border-radius: 50px; border: 0.50px rgba(255, 255, 255, 0.88) solid;
        text-align: center; color: black; font-size: 35px; font-family: 'LINESeedKR-Bd'; font-weight: 400; word-wrap: break-word">
        CREATE
        </button>

        <button type="button" type="button" id="ready-btn" class="Ready" style="width: 203.76px; height: 53px; left: 1000px; top: 792px; position: absolute;
        background: white; border-radius: 50px; border: 1.60px #FBC847 solid; 
        text-align: center; color: black; font-size: 35px; font-family: 'LINESeedKR-Bd'; font-weight: 400; word-wrap: break-word">READY
        </button>

      </div>


      <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.2.0/socket.io.js"></script>
      <script src="./socket.js"></script>
      <script>
          let isChecked = false;
          document.getElementById('nickname').addEventListener('keyup',(event)=>{
              if(event.keyCode === 13){
                  event.preventDefault();
                  document.getElementById('create-btn').click();
              }
          })
          document.getElementById("create-btn").addEventListener('click', async(event)=>{
              const nickname = document.getElementById('nickname').value;
              if(nickname === ""){
                  alert("닉네임을 입력해주세요")
              }
              else{
                  const response = await fetch('/saveData', {
                      method: 'POST',
                      headers: {
                          'Content-Type': 'application/json'
                      },
                      body: JSON.stringify({ nickname })
                  });
                  const data = await response.json(); // data = (서버) 동작 결과
                  
                      if (data.success) {
                          document.getElementById('nickname').disabled = true;
                          isChecked = true;
                          alert('닉네임이 생성되었습니다.');
                          console.log(isChecked)
                      }else //실패
                      {
                          alert('이미 사용중인 닉네임입니다');
                      }
                  }
          })
          document.getElementById('ready-btn').addEventListener('click', async(even) => {
              event.preventDefault();
              const nickname = document.getElementById('nickname').value;
              
              if(!isChecked){
                  alert('닉네임 먼저 만들어주세요')
              }else{
                  console.log('hehe')
                  // 'ready' 값 변경을 요청하는 POST 요청
                  const response = await fetch('/updateReady', {
                      method: 'POST',
                      headers: {
                          'Content-Type': 'application/json',
                      },
                      body: JSON.stringify({ nickname, ready: 1 }), // 준비완료를 나타내는 값 (예: 1) 전달
                  });
  
                  const data = await response.json();
                  if (data.success) {
                      console.log('ha')
                      saveCookie();
                      alert('준비가 완료되었습니다.'); 
                  }
              }
              
          })
          function saveCookie(){
              
              const nick = document.getElementById('nickname').value;
              document.cookie = 'nickname=' + nick;
              console.log(getCookie('nickname'))
          }
          function getCookie(name) {
              const value = '; ' + document.cookie;
              const parts = value.split('; ' + name + '=');
              if (parts.length === 2) return parts.pop().split(';').shift();
          }
  
          socket.on("all-ready",()=>{
              showMessage()
              setTimeout(() => {
                  window.location.href = '/main';
              }, 3000);
              
              let coins = document.querySelectorAll('.Coins');
              let index = 0;
              let interval = setInterval(()=>{
                  if (index < coins.length){
                      coins[index].style.display = 'block';
                      index++;
                  } else {
                      clearInterval(interval)
                  }
              }, 1000);
          })
          
          function showMessage() {
              const messageElement = document.getElementById('message');
              messageElement.textContent = '잠시후 게임이 시작됩니다.';
              messageElement.style.display = 'block';
              setTimeout(() => {
                  messageElement.style.display = 'none';
              }, 3000);
          }
      </script>
</body>
</html>